<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bahasa Kaili Unde - Cerita Bahasa</title>
  <style>
    /* ... CSS Anda yang sudah ada ... (Sama seperti sebelumnya) ... */
    body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; }
    header { background-color: #6200ea; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; font-size: 20px; }
    .dropdown select { padding: 6px 10px; font-size: 14px; border-radius: 5px; border: none; }
    main { padding: 20px; text-align: center; }
    main h2 { margin-bottom: 15px; }
    iframe { width: 100%; max-width: 800px; aspect-ratio: 16 / 9; height: auto; border: none; display: block; margin-left: auto; margin-right: auto; }
    #daftar-video { margin-top: 25px; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto; padding: 0 10px; }
    #daftar-video h3 { margin-bottom: 10px; text-align: center; color: #333; }
    #daftar-video button { display: block; width: 100%; padding: 12px 15px; margin-bottom: 8px; font-size: 1em; text-align: left; cursor: pointer; background-color: #f1f1f1; border: 1px solid #ddd; border-radius: 5px; transition: background-color 0.2s ease; }
    #daftar-video button:hover { background-color: #e0e0e0; }
    @media (max-width: 600px) { header { flex-direction: column; padding: 10px; } header h1 { margin-bottom: 10px; } .dropdown select { width: 100%; } main { padding: 15px; } #daftar-video { padding: 0 5px; } }
  </style>
</head>
<body>

  <header>
    <h1>Bahasa Kaili Unde</h1>
    <div class="dropdown">
      <select id="languageSelect" onchange="navigateToLanguage()">
        <option disabled selected>Pilih Bahasa</option>
        <option value="../duano">Bahasa Duano</option>
        <option value="../haloban">Bahasa Haloban</option>
        <option value="../kaimbulawa">Bahasa Kaimbulawa</option>
        <option value="../kaili-unde">Bahasa Kaili Unde</option>
        <option value="../kamaru">Bahasa Kamaru</option>
        <option value="../kioko">Bahasa Kioko</option>
        <option value="../kumbewaha">Bahasa Kumbewaha</option>
        <option value="../lasalimu">Bahasa Lasalimu</option>
        <option value="../malimpung">Bahasa Malimpung</option>
        <option value="../mandar">Bahasa Mandar</option>
        <option value="../pancana">Bahasa Pancana</option>
        <option value="../sarudu">Bahasa Sarudu</option>
        <option value="../sikule">Bahasa Sikule</option>
        <option value="../suwawa">Bahasa Suwawa</option>
        <option value="../toli-toli">Bahasa Toli Toli</option>
      </select>
    </div>
  </header>

  <main>
    <h2>Video Cerita dalam Bahasa Kaili Unde</h2>
    
    <iframe 
        id="youtube-player" 
        src="about:blank?enablejsapi=1"  
        allowfullscreen> 
        </iframe>

    <div id="daftar-video">
        <h3>Daftar Video:</h3>
        </div>
  </main>

  <script src="https://www.youtube.com/iframe_api"></script>
  
  <script>
    // ID Playlist untuk halaman ini
    const playlistId = 'PL_S3R-nuHsqKSX9PpuFyL4zK6fzuIz4te'; // ID untuk Kaili Unde

    // 2. Fungsi navigasi dropdown (sama seperti sebelumnya)
    function navigateToLanguage() {
      const selectElement = document.getElementById("languageSelect");
      const selectedValue = selectElement.value;
      if (selectedValue) { 
          window.location.href = selectedValue + "/"; 
      }
    }

    // 3. Kode untuk YouTube Player API
    let player; // Variabel global untuk player
    let playlistHasBeenCued = false; // Flag untuk menandai playlist sudah siap

    // Fungsi ini dipanggil otomatis oleh YouTube API
    function onYouTubeIframeAPIReady() {
      console.log("YouTube API Siap.");
      player = new YT.Player('youtube-player', {
        // Kita tidak set videoId atau playlistId di sini
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange // Tambahkan event state change
        }
      });
    }

    // 4. Fungsi yang dipanggil saat pemutar video siap (tapi belum ada video/playlist)
    function onPlayerReady(event) {
      console.log("Player Siap. Memuat playlist:", playlistId);
      // Perintahkan player untuk memuat (cue) playlist secara eksplisit
      player.cuePlaylist({
          list: playlistId,
          listType: 'playlist'
      });
      // Tombol akan dibuat nanti di onPlayerStateChange setelah playlist di-cue
    }

    // 5. Fungsi yang dipanggil saat status player berubah
    function onPlayerStateChange(event) {
        console.log("Player state changed:", event.data);
       // Kita ingin membuat tombol setelah playlist benar-benar siap (status CUED = 5)
       // Gunakan flag agar tidak membuat tombol berkali-kali jika state berubah lagi
       if (event.data == YT.PlayerState.CUED && !playlistHasBeenCued) {
           console.log("Playlist sudah di-cue (siap). Membuat tombol...");
           playlistHasBeenCued = true; // Tandai bahwa kita sudah proses ini
           generatePlaylistButtons(); // Panggil fungsi untuk membuat tombol
       }
    }

    // 6. Fungsi untuk membuat tombol playlist (dipanggil dari onStateChange)
    function generatePlaylistButtons() {
        const daftarVideoContainer = document.getElementById('daftar-video');
        daftarVideoContainer.innerHTML = '<h3>Daftar Video:</h3>'; // Bersihkan dulu

        let playlistIds = [];
        try {
            playlistIds = player.getPlaylist(); // Coba lagi dapatkan ID setelah di-cue
            console.log("Playlist IDs didapatkan:", playlistIds);
        } catch (e) {
            console.error("Gagal mendapatkan daftar Playlist IDs setelah cue:", e);
        }

        if (playlistIds && playlistIds.length > 0) {
            playlistIds.forEach((videoId, index) => {
                const button = document.createElement('button');
                button.textContent = `Video ${index + 1}`; // Judul sementara
                button.onclick = () => {
                    console.log(`Memutar video pada index: ${index} (ID: ${videoId})`);
                    player.playVideoAt(index); 
                };
                daftarVideoContainer.appendChild(button);
            });
        } else {
            console.warn("Tidak dapat mengambil daftar video dari API setelah playlist di-cue.");
            daftarVideoContainer.innerHTML += "<p>Tidak dapat memuat daftar video secara otomatis saat ini.</p>";
        }
    }

  </script>

</body>
</html>
